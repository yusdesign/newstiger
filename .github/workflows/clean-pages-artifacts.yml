name: ðŸ§¹ Clean GitHub Pages Artifacts

on:
  workflow_dispatch:

jobs:
  clean:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      actions: write
      pages: write
      
    steps:
      - name: Delete old GitHub Pages artifacts
        run: |
          echo "ðŸ§¹ Cleaning up old artifacts..."
          
          # Get list of artifacts
          artifacts=$(gh api /repos/${{ github.repository }}/actions/artifacts --paginate | jq -r '.artifacts[] | select(.name | contains("github-pages")) | .id')
          
          if [ -n "$artifacts" ]; then
            echo "Found artifacts: $artifacts"
            for id in $artifacts; do
              echo "Deleting artifact $id"
              gh api -X DELETE /repos/${{ github.repository }}/actions/artifacts/$id
            done
          else
            echo "No artifacts found"
          fi
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
